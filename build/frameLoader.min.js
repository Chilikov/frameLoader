'use strict';var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}(function(name,root,factory){if(typeof define==='function'&&define.amd){define(name,['lodash'],function(_){return factory(root,_)})}else if(typeof module!=='undefined'&&module.exports!==undefined){module.exports=factory(root)}else{root[name]=factory(root,root._)}})('FL_EventEmitter',window||module||{},function(root,_){if(typeof module!=='undefined'&&module.exports){_=require('lodash')}var EventEmitter=function(){function EventEmitter(){_classCallCheck(this,EventEmitter);this.eventSplitter=/\s+/}_createClass(EventEmitter,[{key:'on',value:function on(name,callback,context){if(!this.__ee_eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this}},{key:'once',value:function once(name,callback,context){if(!this.__ee_eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)}},{key:'off',value:function off(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!this.__ee_eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this}},{key:'trigger',value:function trigger(name){if(!this._events)return this;var args=Array.prototype.slice.call(arguments,1);if(!this.__ee_eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)this.__ee_triggerEvents(events,args);if(allEvents)this.__ee_triggerEvents(allEvents,arguments);return this}},{key:'stopListening',value:function stopListening(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;if((typeof name==='undefined'?'undefined':_typeof(name))==='object')callback=this;if(obj)(listeners={})[obj._listenerId]=obj;for(var id in listeners){listeners[id].off(name,callback,this);if(deleteListener)delete this._listeners[id]}return this}},{key:'__ee_eventsApi',value:function __ee_eventsApi(obj,action,name,rest){if(!name)return true;if((typeof name==='undefined'?'undefined':_typeof(name))==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}return false}if(this.eventSplitter.test(name)){var names=name.split(this.eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}return false}return true}},{key:'__ee_triggerEvents',value:function __ee_triggerEvents(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l){(ev=events[i]).callback.call(ev.ctx)}return;case 1:while(++i<l){(ev=events[i]).callback.call(ev.ctx,a1)}return;case 2:while(++i<l){(ev=events[i]).callback.call(ev.ctx,a1,a2)}return;case 3:while(++i<l){(ev=events[i]).callback.call(ev.ctx,a1,a2,a3)}return;default:while(++i<l){(ev=events[i]).callback.apply(ev.ctx,args)}}}},{key:'listenTo',value:function listenTo(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId('l'));listeners[id]=obj;if((typeof name==='undefined'?'undefined':_typeof(name))==='object')callback=this;obj.on(name,callback,this);return this}},{key:'listenToOnce',value:function listenToOnce(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId('l'));listeners[id]=obj;if((typeof name==='undefined'?'undefined':_typeof(name))==='object')callback=this;obj.once(name,callback,this);return this}}]);return EventEmitter}();return EventEmitter});(function(name,root,factory){if(typeof define==='function'&&define.amd){define(name,['FL_EventEmitter'],function(EventEmitter){return factory(root,EventEmitter)})}else if(typeof module!=='undefined'&&module.exports!==undefined){module.exports=factory(root)}else{root[name]=factory(root,root.FL_EventEmitter)}})('FL_Loader',window||module||{},function(window,EventEmitter){if(typeof module!=='undefined'&&module.exports){EventEmitter=require('./eventEmitter')}var Loader=function(_EventEmitter){_inherits(Loader,_EventEmitter);function Loader(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Loader);var _this=_possibleConstructorReturn(this,(Loader.__proto__||Object.getPrototypeOf(Loader)).call(this));_this.options=opts;if(!_this.options.url){var _ret;return _ret=console.warn('FrameLoader: error missed frame URL'),_possibleConstructorReturn(_this,_ret)}if(!_this.options.el){var _ret2;return _ret2=console.warn('FrameLoader: error missed frame container'),_possibleConstructorReturn(_this,_ret2)}if(document.readyState==='interactive'||document.readyState==='complete'){_this._initFrame()}return _this}_createClass(Loader,[{key:'_initFrame',value:function _initFrame(){var el;if(this.options.el instanceof HTMLElement){this.el=this.options.el}else{try{el=document.querySelector(this.options.el);this.el=el?el:null}catch(e){}}this.id=this.options.id||'frame'+this.options.url;this._loadFrame();return this}},{key:'_loadFrame',value:function _loadFrame(){var _this2=this;var frame;frame=this.frame=document.createElement('iframe');frame.onload=function(){_this2._frameInteractive();window.addEventListener('message',_this2._onMessage.bind(_this2))};frame.src=this.options.url;frame.setAttribute('frameborder',0);frame.setAttribute('scrolling','no');frame.style.backgroundColor='transparent';this.el.appendChild(frame)}},{key:'_frameInteractive',value:function _frameInteractive(){var _this3=this;var initInterval=setInterval(function(){if(_this3.initSuccess){clearInterval(initInterval)}else{_this3.send(Object.assign({type:'__init',id:_this3.id}))}},50)}},{key:'_onMessage',value:function _onMessage(){var event=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var data=event.data||{},messageType='message';if(!data.id||data.id!==this.id){return this}if(data.type==='__initSuccess'){this.initSuccess=true;if(typeof this.options.onLoad==='function'){this.options.onLoad(this.frame)}this.trigger('load',this.frame);return this}if(data.style!==undefined){this._updateStyle(data.style)}if(typeof this.options.onMessage==='function'){this.options.onMessage(data)}if(data.type){this.trigger(messageType+':'+data.type,data,event)}this.trigger(messageType,data,event)}},{key:'_updateStyle',value:function _updateStyle(){var style=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var prop;for(prop in style){if(style.hasOwnProperty(prop)){this.frame.style[prop]=style[prop]}}}},{key:'send',value:function send(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};data=Object.assign({},data,{id:this.id});if(this.frame){this.frame.contentWindow.postMessage(data,options.origin||'*')}return this}},{key:'show',value:function show(){if(this.el){this.el.style.display=this.elDisplayType||'block'}}},{key:'hide',value:function hide(){if(this.el){this.elDisplayType=this.el.style.display||'block';this.el.style.display='none'}}}]);return Loader}(EventEmitter);return Loader});(function(name,root,factory){if(typeof define==='function'&&define.amd){define(name,['FL_EventEmitter'],function(EventEmitter){return factory(root,EventEmitter)})}else if(typeof module!=='undefined'&&module.exports!==undefined){module.exports=factory(root)}else{root[name]=factory(root,root.FL_EventEmitter)}})('FL_Listener',window||module||{},function(window,EventEmitter){if(typeof module!=='undefined'&&module.exports){EventEmitter=require('./eventEmitter')}var Listener=function(_EventEmitter2){_inherits(Listener,_EventEmitter2);function Listener(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Listener);var _this4=_possibleConstructorReturn(this,(Listener.__proto__||Object.getPrototypeOf(Listener)).call(this));_this4.options=opts;if(window.parent!==window){_this4._listen()}return _this4}_createClass(Listener,[{key:'send',value:function send(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};data=Object.assign({},data,{id:this.id});if(window.parent){window.parent.postMessage(data,options.origin||'*')}return this}},{key:'style',value:function style(){var _style=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.send({style:_style})}},{key:'_listen',value:function _listen(){var _this5=this;window.addEventListener('message',function(e){var data=e.data||{},messageType='message';if(data.type==='__init'){_this5.id=data.id;_this5.send({type:'__initSuccess'});if(typeof _this5.options.onLoad==='function'){_this5.options.onLoad()}_this5.trigger('load')}else if(_this5.id===data.id){if(typeof _this5.options.onMessage==='function'){_this5.options.onMessage(data)}if(data.type){_this5.trigger(messageType+':'+data.type,data,e)}_this5.trigger(messageType,data,e)}})}}]);return Listener}(EventEmitter);return Listener});(function(name,root,factory){if(typeof define==='function'&&define.amd){define(name,['FL_Loader','FL_Listener'],function(Loader,Listener){return factory(root,Loader,Listener)})}else if(typeof module!=='undefined'&&module.exports!==undefined){module.exports=factory(root)}else{root[name]=factory(root,root.FL_Loader,FL_Listener)}})('FrameLoader',window||module||{},function(window,Loader,Listener){if(typeof module!=='undefined'&&module.exports){Loader=require('./loader.es6')}if(typeof module!=='undefined'&&module.exports){Listener=require('./listener.es6')}return{Loader:Loader,Listener:Listener}});
